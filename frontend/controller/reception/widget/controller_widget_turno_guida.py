#######################################################
# 
# ControllerWidgetTurnoGuida.py
# Python implementation of the Class ControllerWidgetTurnoGuida
# Generated by Enterprise Architect
# Created on:      07-ott-2022 17:39:59
# Original author: ValerioMorelli
# 
#######################################################

from backend.high_level.clientela.biglietto import Biglietto
from backend.high_level.gestione_interna.turno_guida import TurnoGuida
from backend.high_level.museo import Museo
from frontend.controller.amministrazione.controller_modifica_turno_guida import ControllerModificaTurnoGuida
from frontend.controller.controller import Controller
from frontend.controller.reception.strategy_turni_guide.strategy_turni_guide import StrategyTurniGuide
from frontend.view.reception.vista_modifica_turno_guida import VistaModificaTurnoGuida
from frontend.view.reception.widget.widget_turno_guida import WidgetTurnoGuida


class ControllerWidgetTurnoGuida(Controller):

    def __init__(self, view: WidgetTurnoGuida, model: TurnoGuida, parent: Controller, strategy: StrategyTurniGuide):
        super().__init__(view)
        self.view: WidgetTurnoGuida = view
        self.model = model
        self.parent = parent
        self.strategy = strategy
        self.initializeUi()
        self.connettiEventi()

    def __onSelezionaClicked(self) -> None:
        pass  # TODO

    def __onRimuoviButton(self) -> None:
        # rimuovo il turno alla guida
        self.model.guida.turni.remove(self.model)
        # rimuovo il turno dal museo (db)
        Museo.getInstance().turni_guida.remove(self.model)
        self.parent.initializeUi()
    def __onModificaButton(self) -> None:
        self.next=ControllerModificaTurnoGuida(
            view=VistaModificaTurnoGuida(),
            previous=self.parent,
            model=self.model,
        )
        self.next.guida=self.model.guida
        self.next.showView()
        self.parent.disableView()
    def connettiEventi(self) -> None:
        self.view.getRimuoviButton().clicked.connect(self.__onRimuoviButton)
        self.view.getModificaButton().clicked.connect(self.__onModificaButton)
        self.view.getSelezionaButton().clicked.connect(self.__onSelezionaClicked)

    def initializeUi(self) -> None:
        self.strategy.initializeWidgetUi(self)
        self.view.getNomeLabel().setText(self.model.guida.dipendente.nome + ' ' + self.model.guida.dipendente.cognome)
        self.view.getOrarioLabel().setText('{}-{}'.format(
            self.model.data_inizio.strftime('%H:%M'),
            self.model.data_fine.strftime('%H:%M'),
        ))
        self.view.getPostiDisponibiliLabel().setText(
            'posti liberi {}/{}'.format(self.model.numero_prenotati, self.model.capienza))

