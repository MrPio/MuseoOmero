#######################################################
# 
# StrategyConvalidaBiglietto.py
# Python implementation of the Class StrategyConvalidaBiglietto
# Generated by Enterprise Architect
# Created on:      07-ott-2022 17:40:01
# Original author: ValerioMorelli
# 
#######################################################
from datetime import timedelta

from backend.high_level.museo import Museo
from frontend.controller.segreteria.strategy_convalida.strategy_convalida import StrategyConvalida


class StrategyConvalidaBiglietto(StrategyConvalida):
    def __init__(self) -> None:
        self.biglietto: 'Biglietto' | None = None
        self.model = Museo.getInstance()

    def initializeUi(self, c: 'ControllerConvalida') -> None:
        c.view.getHeaderLabel().setText('HomeReception ➜ ConvalidaBiglietto')

    def finalizza(self, c: 'ControllerConvalida', id: str) -> bool:
        for visitatore in self.model.visitatori:
            for biglietto in visitatore.biglietti:
                if id == biglietto.qr_code.id:
                    esito = biglietto.convalida()
                    c.notifica(
                        titolo='Successo' if esito else 'Attenzione!',
                        contenuto='Convalida avvenuta con successo' if esito
                        else f'Biglietto scaduto il '
                             f'{(biglietto.data_rilascio + timedelta(days=1)).strftime("%Y/%m/%d %H:%M")}' if biglietto.isScaduto()
                        else 'Biglietto non pagato!'
                    )
                    return True

        c.notifica('Biglietto non trovato',
                   'Spiacenti, non è stato trovato alcun biglietto relativo al codice inserito.')
        return False
